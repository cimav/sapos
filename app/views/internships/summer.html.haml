:css
  .error-message{
    color: red;
  }
  
  .inputfile{
    width: 0.1px;
    height:0.1px;
    opacity: 0;
    overflow: hidden;
    position: absolute;
    z-index: -1;
  }
  
  .inputfile + label{
    font-size: 14px;
    font-weight: 600;
    color: white;
    background-color: #336699;
    display: inline-block;
    transition: all .5s;
    cursor: pointer;
    padding: 8px 25px !important;
    //width: fit-content;
    border-radius: 8px;
    text-align: center;
  }  
  
  .inputfile:focus + label,
  .inputfile + label:hover {
    background-color: #003366;
  }
  
  .tooltiptext{
    font-size: 12px;
    visibility: hidden;
    background-color: #d8e5f3;
    color: black;
    text-align:center;
    border-radius: 6px;   
    padding: 8px 25px !important;
    position: absolute;
    z-index: 1;
  }
  
  .reqdoc_button, .reqdoc_button_download, .reqdoc_button_delete{
    font-size: 14px;
    font-weight: 600;
    color: white;
    background-color: #336699;
    display: inline-block;
    transition: all .5s;
    cursor: pointer;
    padding: 8px 25px !important;
    //width: fit-content;
    border-radius: 8px;
    text-align: center;
  }
  
:javascript
  var my_id;
  function display_status(type,my_id){
    if(type=="ok"){
      $("#img_ok_"+my_id).css("display","inline-block");
      $("#img_load_"+my_id).css("display","none");
      $("#img_fail_"+my_id).css("display","none");
    }
    else if(type=="load"){
      $(".reqdoc_button").prop("disabled","disabled");
      $(".reqdoc_button_delete").prop("disabled","disabled");
      $("#img_ok_"+my_id).css("display","none");
      $("#img_load_"+my_id).css("display","inline-block");
      $("#img_fail_"+my_id).css("display","none");
      $("#img_load_"+my_id).css("display","inline-block");

    }
    else if(type=="fail"){
      $("#img_ok_"+my_id).css("display","none");
      $("#img_load_"+my_id).css("display","none");
      $("#img_fail_"+my_id).css("display","inline-block");
    }
  }

  $(document).ready(function() {
    $(".reqdoc_button_download").click(function(){
      my_id       = $(this).attr("my_id");
      var my_file_id  = $(this).attr("my_file_id");
      $("#files_iframe2").attr("src","/internados/aspirantes/file/"+my_file_id);
    });

    $(".reqdoc_button_delete").click(function(){
      my_id       = $(this).attr("my_id");
      var my_file_id  = $(this).attr("my_file_id");
      display_status("load",my_id);
      $("#files_iframe2").attr("src","/internados/aspirantes/destroy_file/"+my_file_id);
    });

    $(".reqdoc_button").click(function(){
      my_id   = $(this).attr("my_id");
      var form_id = "#internship_file_file_"+my_id;
      var valor = $(form_id).val();

      p      = $(this).parent();
      f_type = p.find("#file_type").val();

      if(f_type==5)
      {
        var myRe = /\dfsdfsadsda$/i;
      }
      else
      {
        var myRe = /(\.pdf$)|(\.jpg)|(\.jpeg)|(\.png)/i;
      }

      if(myRe.test(valor))
      {
        display_status("load",my_id);
        var form_id = "#reqdoc-form-"+my_id;
        $(form_id).submit();
      }else{
        if(f_type==5){
          var myRe = /\.pdf$/i;
          if(myRe.test(valor)){
            alert("Debe ser forzosamente imagen");
          }
          else
          {
            display_status("load",my_id);
            var form_id = "#reqdoc-form-"+my_id;
            $(form_id).submit();
          }
        }
        else
        {
          alert("Solo puedes subir archivos pdf, jpeg, jpg, png");
        }
      }


    });

    $("#files_iframe2").load(function(){
      var sts = $('#files_iframe2').contents().find("status").html();
      var ref = $('#files_iframe2').contents().find("reference").html();

      if(sts=="0")
      {
        errors  = $('#files_iframe2').contents().find("errors").html();
        alert(errors);

        if(ref=="upload"){
          display_status("fail",my_id);
        }
        else if(ref=='destroy')
        {
          display_status("ok",my_id);
        }
      }
      else if(sts=="1")
      {
        if(ref=="upload")
        {
          var new_id = $('#files_iframe2').contents().find("id").html();
          display_status("ok",my_id);
          $("#internship_file_file_"+my_id).css("display","none");
          $("#internship_file_file_label_"+my_id).css("display","none");

          $("#reqdoc_button_"+my_id).css("display","none");
          $("#reqdoc_button_download_"+my_id).css("display","inline-block");
          $("#reqdoc_button_delete_"+my_id).css("display","inline-block");

          $("#reqdoc_button_"+my_id).attr("my_file_id",new_id);
          $("#reqdoc_button_download_"+my_id).attr("my_file_id",new_id);
          $("#reqdoc_button_delete_"+my_id).attr("my_file_id",new_id);
        }
        else if(ref=="destroy")
        {
          display_status("fail",my_id);
          $("#internship_file_file_"+my_id).val("");
          $("#internship_file_file_"+my_id).css("display","inline-block");
          
          $("#internship_file_file_label_"+my_id).html("Seleccionar archivo");
          $("#internship_file_file_label_"+my_id).css("display","inline-block");

          $("#reqdoc_button_"+my_id).css("display","inline-block");
          $("#reqdoc_button_download_"+my_id).css("display","none");
          $("#reqdoc_button_delete_"+my_id).css("display","none");
        }


        $(".reqdoc_button").removeAttr("disabled");
        $(".reqdoc_button_delete").removeAttr("disabled");

       var files_req_missing  =  $(".fields_requested .field_requested_document[required=1] .img-ok:hidden")
    
       if(files_req_missing.length==0){
         $("#finalize_button").show();
       }else{
         $("#finalize_button").hide();
       }

      }
    });

      $('.inputfile').change(function(){
        var filename = $(this).val().split('\\').pop();
        var idname   = $(this).attr('id'); 
                
        $('#tooltip_'+idname.split('_').pop()).html(filename);
        $('#'+idname).next().html(filename.slice(0,17));
      });
      
      $('.inputfile+label').mouseover(function(){
        var idname   = $(this).attr('id');
        var tooltip = '#tooltip_'+idname.split('_').pop()
        console.log('|'+tooltip+'|');
        $(tooltip).css("visibility","visible");
      });
      
      $('.inputfile+label').mouseout(function(){
        var idname   = $(this).attr('id');
        var tooltip = '#tooltip_'+idname.split('_').pop()
        console.log(tooltip);
        $(tooltip).css("visibility","hidden");
      });
        
  });


%nav.navbar.navbar-dark.bg-white.shadow-lg.p-3.mb-5.rounded.sticky-top
  %a.navbar-brand{:href => "#"}
    %img.d-inline-block.align-top{:alt => "", :height => "30", :src => "https://cimav.edu.mx/wp-content/themes/cimav2017/img/logo-top.png"}
    
.container#applicantFormContent{style:'margin-bottom:2em;'}
  .row
    %h1.text-secondary{style:'font-size:1.9em; padding:1em;'} Solicitud de Verano CIMAV
  .card.border-light
    .card-body.terms{:style=>"display:none;"}
      = "El registro se ha realizado correctamente, espere instrucciones por correo."
  .row.text-center
    .alert.alert-primary.col-sm{:role=>"alert"}
      = "Se recomienda utilizar archivos menores de 20MB"
  .row
    .fields_requested.table-responsive
      %table.table
        %thead
          %tr
            %th="#"
            %th="DescripciÃ³n"
            %th="Controles"
            %th="Estatus"
        %tbody     
          - counter = 1
          - @req_docs.each do |key, value|
            - if  @internship_files.where(:file_type=>key).size > 0
              - @internship_files.where(:file_type=>key).each do |af|
                - required= 1

                %tr.field_requested_document{:required=>required}
                  - my_id = key
                  = form_for(InternshipFile.new, :url => {:action => "upload_file_register"}, :html => {:id => "reqdoc-form-#{my_id}", :multipart=> true,:target=>'files_iframe2'}) do |f|
                    = hidden_field_tag :internship_id, @internship.id
                    = hidden_field_tag :file_type, my_id
                    %td= counter
                    - counter = counter + 1
                    %td
                      %b= label_tag value

                    %td
                      = f.file_field :file,:id=>"internship_file_file_#{my_id}",:class=>"inputfile"
                      = label_tag "internship_file_file_#{my_id}", "Seleccionar archivo",:id=>"internship_file_file_label_#{my_id}", :style=>"display: none;"
                      .tooltiptext{:id=>"tooltip_#{my_id}"}= "Seleccionar archivo"
                      = button_tag @t[:upload_file], :type=>'button', :class=>'reqdoc_button', :my_id=>"#{my_id}", :id=>"reqdoc_button_#{my_id}",:style=>"display:none;"
                      - if !@register
                        = button_tag "Descargar Archivo", :type=>'button', :class=>'reqdoc_button_download', :my_id=>"#{my_id}", :id=>"reqdoc_button_download_#{my_id}",:my_file_id=> af.id
                        = button_tag @t[:delete_file], :type=>'button', :class=>'reqdoc_button_delete', :my_id=>"#{my_id}", :id=>"reqdoc_button_delete_#{my_id}",:my_file_id=> af.id

                    %td              
                      = image_tag "fail_40px.png", :id=> "img_fail_#{my_id}" , :style=>'display: none;', :class=>"class-img-top"
                      = image_tag "/images/ajax-load2.gif", :id=> "img_load_#{my_id}" , :style=>'display: none;',:class=>"class-img-top"
                      = image_tag "ok_40px.png", :id=> "img_ok_#{my_id}" , :class=>"img-ok"

            - else
              - required= 1
              %tr.field_requested_document{:required=>required}
                - my_id = key
                = form_for(InternshipFile.new, :url => {:action => "upload_file_register"}, :html => {:id => "reqdoc-form-#{my_id}", :multipart=> true,:target=>'files_iframe2'}) do |f|
                  = hidden_field_tag :internship_id, @internship.id
                  = hidden_field_tag :file_type, my_id
                  = hidden_field_tag :my_file_id, 0
                  %td= counter
                  - counter = counter + 1
                  %td
                    %b= label_tag value
                  %td
                    - if !(my_id.eql? 6)
                      = f.file_field :file,:id=>"internship_file_file_#{my_id}",:class=>"inputfile"
                      = label_tag "internship_file_file_#{my_id}","Seleccionar archivo",:id=>"internship_file_file_label_#{my_id}"
                      .tooltiptext{:id=>"tooltip_#{my_id}"}= "Seleccionar archivo"
                      = button_tag @t[:upload_file], :type=>'button', :class=>'reqdoc_button', :my_id=>"#{my_id}", :id=>"reqdoc_button_#{my_id}"
                    - if !@register  
                      = button_tag "Descargar Archivo", :type=>'button', :class=>'reqdoc_button_download', :my_id=>"#{my_id}", :id=>"reqdoc_button_download_#{my_id}", :style=>'display: none;', :my_file_id=>0
                      = button_tag @t[:delete_file], :type=>'button', :class=>'reqdoc_button_delete', :my_id=>"#{my_id}", :id=>"reqdoc_button_delete_#{my_id}", :style=>'display:none;', :my_file_id=> 0
                  %td
                    = image_tag "fail_40px.png", :id=> "img_fail_#{my_id}" ,:align=> 'center'
                    = image_tag "/images/ajax-load2.gif", :id=> "img_load_#{my_id}" , :align=> 'center',:style=>'display: none;'
                    = image_tag "ok_40px.png", :id=> "img_ok_#{my_id}" , :align=> 'center', :style=>'display: none',:class=>"img-ok"
      .row
        .col.text-center
          = hidden_field_tag "itoken",params[:token]
          = button_tag "Finalizar Registro", :type=>'button',:id=>"finalize_button"
                    
  %iframe{"name" => "files_iframe2", "id" => "files_iframe2" ,:style=> "display: none;"}
  
    
:javascript
  $(document).ready(function() {
    var files_req_missing  =  $(".fields_requested .field_requested_document[required=1] .img-ok:hidden")
    
    if(files_req_missing.length==0){
      $("#finalize_button").show();
    }else{
      $("#finalize_button").hide();
    }
  });