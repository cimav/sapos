- @st_js = @states.map{|i| [i.id,i.name]}

= "Todos los campos son obligatorios"
%br=""
= form_for @internship, :url=>{action: "applicant_create"} , :remote => true, :html => { :'data-type' => 'html', :id => 'item-new-internship-applicant-form' } do |f|
  .field#field_internship_first_name
    = f.label :first_name, 'Nombre'
    = f.text_field :first_name

  .field#field_internship_last_name
    = f.label :last_name, 'Apellidos'
    = f.text_field :last_name

  .field#field_internship_gender
    = f.label :gender, 'Sexo'
    = f.select :gender,  [['',''],['Hombre', 'H'], ['Mujer', 'F']]

  .field#field_internship_date_of_birth
    = f.label :date_of_birth, 'Fecha de nacimiento'
    = f.date_select :date_of_birth, :start_year => DateTime.now.year - 80

  .field#field_internship_country_id
    = f.label :country_id, 'País de nacimiento'
    = f.collection_select :country_id, @countries, :id, :name, options = {:prompt => "Selecciona un país"}

  .field#field_internship_state_id
    = f.label :state_id, 'Estado de Nacimiento'
    = f.collection_select :state_id, @states, :id, :name, options = {:prompt => "Selecciona un estado"}

  .field#field_internship_curp
    = f.label :curp, 'Curp'
    = f.text_field :curp

  .field#field_internship_email
    = f.label :email, 'Correo Electrónico'
    = f.email_field :email
  
  .field#field_internship_phone
    = f.label :phone, 'Teléfono de contacto'
    = f.text_field :phone
  
  .field#field_internship_health_insurance
    = f.label :health_insurance, 'Servicio médico'
    = f.text_field :health_insurance
  
  .field#field_internship_health_insurance_number
    = f.label :health_insurance_number, 'Número de afiliación o poliza'
    = f.text_field :health_insurance_number
  
  .field#field_internship_accident_contact
    = f.label :accident_contact, 'Contacto en caso de accidente'
    = f.text_field :accident_contact

  .field#field_internship_institution_id
    = f.label :institution_id, 'Institución'
    = f.collection_select :institution_id, @institutions, :id, :name, options = {:prompt => "Selecciona tu institucion de procedencia"}
    = text_field_tag :text_institution_id, '', :size=>75,:placeholder=>"¿Cual?"

  .field#field_internship_internship_type_id
    = f.label :internship_type_id, 'Tipo'
    = f.collection_select :internship_type_id, @internship_types, :id, :name, options = {:prompt => "Selecciona el tipo de servicio"}
    = text_field_tag :text_internship_type_id, '', :size=>25, :placeholder=>"¿Cual?"


  - if @option.eql? "monterrey"
    - f_class = "v-hidden"
  - else
    - f_class = "field"
  .field#field_internship_area_id{:class=>f_class}
    = f.label :area_id, 'Area'
    - if @option.eql? "monterrey"
      = f.collection_select :area_id, @areas, :id, :name
    - else
      = f.collection_select :area_id, @areas, :id, :name, options = {:prompt => "Selecciona el area"}

  .field#field_internship_submit
    %table
      %tr
        %td= f.submit 'Enviar'
        %td= "&nbsp;".html_safe
        %td= image_tag "/images/ajax-load2.gif", :id=> "img_load" , :align=> 'center',:style=>'display: none;'

:javascript
  var model_name = 'internship';
  var states     = #{@st_js.to_json}

  function full_states(){
    var select = $("#internship_state_id")
    if(select.prop) {
    var options = select.prop('options');
    }
    else {
      var options = select.attr('options');
    }
    $('option', select).remove();

    $.each(states, function(index, value) {
      if(index==0){
        options[options.length] = new Option("Selecciona un estado", "");
      }
      else{
        options[options.length] = new Option(value[1], value[0]);
      }
    });
  }

  function add_options(select,opts)
  {
    if(select.prop) {
    var options = select.prop('options');
    }
    else {
      var options = select.attr('options');
    }

    $.each(opts, function(index, value) {
      options[options.length] = new Option(value[1], value[0]);
    });
  }

  $(document).ready(function() {
    $("#internship_country_id").change(function(){
      if($(this).val()==146){
        full_states();
        return false;
      }else
      {
        $("#internship_state_id").empty().append('<option value="'+states[0][0]+'">'+states[0][1]+'</option>');
      }
    });

    $("#internship_internship_type_id").change(function(){
        if($(this).val()==0){
          $("#text_internship_type_id").show();
        }else{
          $("#text_internship_type_id").hide();
        }
    });

    $("#internship_institution_id").change(function(){
        if($(this).val()==0){
          $("#text_institution_id").show();
        }else{
          $("#text_institution_id").hide();
        }
    });

    $("#internship_state_id").empty().append('<option value="'+states[0][0]+'">'+states[0][1]+'</option>');
    add_options($("#internship_institution_id"),[[0,"Otra institucion"]]);
    add_options($("#internship_internship_type_id"),[[0,"Otro tipo de servicio"]]);
    $("#text_internship_type_id").hide();
    $("#text_institution_id").hide();
  });
