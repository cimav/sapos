= stylesheet_link_tag "https://fonts.googleapis.com/icon?family=Material+Icons"

:css
  .material-icons.md-18 { font-size: 18px; }
  .material-icons.md-24 { font-size: 24px; }
  .material-icons.md-36 { font-size: 36px; }
  .material-icons.md-48 { font-size: 48px; }
  
  .container { margin: auto; }
  .enrollment-files { float: left; }
  .enrollment-upload { float: right; }
  .enrollment-message { clear: both; text-align: center; color: red; font-size: 18px; }
  
  .icon-upload { cursor: pointer; }
  .icon-upload:hover { color: #505050; } 
  .icon-delete { cursor: pointer; }
  .icon-delete:hover { color: #505050; } 
  .hidden-message { display: none; }
  .div-center { text-align: center; }
  
  .enrollment-button-group{ margin: auto; width: 300px; heigth: 32px; padding-top:20px;}
  .button-yes{ float: right; }
  .button-no{ float: left; }
  
  .delete-button{width: 140px; height: 30px;}
  .delete-button:hover{width: 138px; heigth: 28px; color: black; border-bottom: 2px solid #ddd; border-left: 2px solid #ddd;}
  
  .upload-btn-wrapper {
    padding-top:10px;
    clear:both;
  }
  
.container#content-panel
  .enrollment-message
    = "#{params[:message]}"

  .enrollment-files
    - if @enrollment_files.size > 0
      - @enrollment_files.each do |file|
        %b= file.term.name
        = "&nbsp".html_safe
        %a{:id=>"file_description_#{file.id}",:href=>"/estudiantes/archivos/cvus/file/#{file.id}"}= file.description
        %i.material-icons.icon-delete{:file_id=>file.id,:student_id=>file.student_id}= "delete"
        %br
    - else
      = "No se ha encontrado ningún archivo"

  .enrollment-upload
    %i.material-icons.md-48.icon-upload{:student_id=>@student_id}= "cloud_upload"
       
#alerta.hidden-message
  .div-center
    %h3= "¿Está seguro que desea eliminar el siguiente archivo?"
    %h3#delete_file_name
    .enrollment-button-group
      %button.button-yes.delete-button{:choice=>"si"}
        ="Si"
      %button.button-no.delete-button{:choice=>"no"}
        ="No"
        
#enrollment-upload.hidden-message
  = form_for(EnrollmentFile.new, :url => {:action => "upload_file_register"}, :html => {:id => "reqdoc-form-1", :multipart=> true,:target=>'files_iframe2'}) do |f|
  
    .div-center
      .enrollment-file-term
        = "Ciclo escolar"
        = f.hidden_field :student_id, :value=>@student_id
        = f.hidden_field :enrollment_type_id, :value=>1
        = f.select :term_id, options_from_collection_for_select(@terms,:id,:name), :prompt=>"-- Elija un ciclo escolar --", :class=>"select-with-terms",:id=>"select_with_terms_xidx"
        .upload-btn-wrapper
          %button.btn{:style=>"display: none;"}= "Seleccionar Archivo"
          = f.file_field :file,:class=>"inputfile2"
          %br
          =# label_tag "enrollment_file[file]","Eliga un archivo"
          = label_tag "file","Selecciona un archivo"

        .enrollment-button-group
          %button.button-yes.upload-button{:choice=>"si"}
            ="Continuar"
          %button.button-no.upload-button{:choice=>"no"}
            ="Cancelar"
 
:javascript
  my_id = 0;
  
  $(document).ready(function(){
    $(".icon-delete").click(function(){
      my_id       = $(this).attr("file_id");
      student_id  = $(this).attr("student_id");
      
      var description = $("#file_description_"+my_id).html();
      $('#delete_file_name').html(description);
            
      var html        = $("#alerta").html();

      $("#new-advance-dialog").remove();
      $('#content-panel').append('<div title="" id="new-advance-dialog">'+html+'</div>');
      $("#new-advance-dialog").dialog({ autoOpen: false, width: 450, height: 200, modal:true });
      $("#new-advance-dialog").dialog('open');
      
      $(".delete-button").click(function(){
        var attr_id = $(this).attr("choice");
               
        if(attr_id=='si')
        {
          console.log("Click: "+attr_id);
          console.log(my_id+"|"+student_id);
          window.location= "/estudiantes/"+student_id+"/archivos/cvu/eliminar/"+my_id;
        }
        else if(attr_id=='no')
        {
          console.log("Click: "+attr_id);
          $("#new-advance-dialog").dialog('close');
        }
        else
        {
          console.log("Opcion desconocida");
        }
      });
      
    }); // fin icon-delete
    
    
    $(".icon-upload").click(function(){
      student_id  = $(this).attr("student_id");
      
      window.location = window.location= "/estudiantes/"+student_id+"/archivos/cvu/upload/file";
      
    }); // fin icon upload
    
    
    $("#new-advance-dialog input[type='file']").change(function(e) {
      filename = $(this).val().split('\\').pop();
      $("#new-advance-dialog label").html(filename);             
    })
  });// fin document.ready